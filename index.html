<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make the Number</title>
    <link href="https://fonts.googleapis.com/css2?family=CMU+Serif:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'CMU Serif', serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .tabs-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #ecf0f1;
        }
        
        .tab {
            padding: 15px 30px;
            background: #ecf0f1;
            border: none;
            font-family: 'CMU Serif', serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px 10px 0 0;
            margin: 0 2px;
            position: relative;
            top: 3px;
        }
        
        .tab:hover {
            background: #d5dbdb;
            color: #2c3e50;
        }
        
        .tab.active {
            background: white;
            color: #2c3e50;
            border: 3px solid #3498db;
            border-bottom: 3px solid white;
            top: 0;
        }
        
        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .left-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .time-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-input input {
            width: 80px;
            padding: 8px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-family: 'CMU Serif', serif;
            font-size: 1rem;
            text-align: center;
        }
        
        .game-info {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-bottom: 30px;
        }
        
        .info-item {
            text-align: center;
        }
        
        .target-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            transition: all 0.3s ease;
        }
        
        .target-number.spinning {
            animation: randomSpin 0.6s ease-in-out;
        }
        
        .timer {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            transition: all 0.3s ease;
        }
        
        .timer.win {
            color: #27ae60;
        }
        
        .timer.timeout {
            color: #e74c3c;
        }
        
        .main-content {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }
        
        .left-section {
            flex: 1;
            order: 2;
        }
        
        .operators-container {
            order: 1;
        }
        
        .numbers-section {
            margin-bottom: 30px;
        }
        
        .numbers-container {
            display: grid;
            gap: 15px;
            margin: 0 auto 20px auto;
        }
        
        .numbers-container.four-numbers {
            grid-template-columns: repeat(2, 1fr);
            max-width: 200px;
        }
        
        .numbers-container.five-numbers {
            grid-template-columns: repeat(3, 1fr);
            max-width: 300px;
        }
        
        .results-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 100px;
            align-items: center;
        }
        
        .number-box {
            width: 80px;
            height: 80px;
            border: 3px solid #3498db;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .number-box.original {
            border-color: #3498db;
        }
        
        .number-box.result {
            border-color: #e67e22;
            background: #fdf2e9;
        }
        
        .number-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .number-box.selected {
            background: #3498db;
            color: white;
            transform: scale(1.1);
        }
        
        .number-box.result.selected {
            background: #e67e22;
        }
        
        .number-box.win {
            background: #27ae60 !important;
            border-color: #27ae60 !important;
            color: white !important;
            animation: celebrate 2s ease-in-out infinite;
        }
        
        .number-box.animate-in {
            animation: slideIn 0.2s ease-out;
        }
        
        .number-box.animate-out {
            animation: slideOut 0.15s ease-in forwards;
        }
        
        .number-box.used {
            opacity: 0.3;
            pointer-events: none;
            transform: scale(0.8);
            transition: all 0.15s ease-in;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes slideOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.8);
            }
        }
        
        @keyframes randomSpin {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(360deg); }
        }
        
        @keyframes celebrate {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 20px rgba(39, 174, 96, 0.6);
            }
            25% { 
                transform: scale(1.1) rotate(5deg);
                box-shadow: 0 0 30px rgba(39, 174, 96, 0.8);
            }
            50% { 
                transform: scale(1.05) rotate(0deg);
                box-shadow: 0 0 40px rgba(39, 174, 96, 1);
            }
            75% { 
                transform: scale(1.1) rotate(-5deg);
                box-shadow: 0 0 30px rgba(39, 174, 96, 0.8);
            }
        }
        
        .number-box.spinning {
            animation: randomSpin 0.6s ease-in-out;
        }
        
        .operators-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 300px;
        }
        
        .operator-btn {
            padding: 12px;
            border: 2px solid #9b59b6;
            border-radius: 12px;
            background: white;
            font-family: 'CMU Serif', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: #9b59b6;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
        }
        
        .operator-btn:hover {
            background: #9b59b6;
            color: white;
            transform: translateY(-3px);
        }
        
        .operator-btn.selected {
            background: #9b59b6;
            color: white;
            transform: scale(1.05);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-family: 'CMU Serif', serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #27ae60;
            color: white;
        }
        
        .btn-primary:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }
        
        .reset-container {
            text-align: center;
            margin-top: 30px;
        }
        
        .message {
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .success {
            background: #d5f4e6;
            color: #27ae60;
            border: 2px solid #27ae60;
        }
        
        .error {
            background: #fadbd8;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }
        
        .info {
            background: #ebf3fd;
            color: #3498db;
            border: 2px solid #3498db;
        }
        
        .auth-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .auth-container .btn {
            margin: 0 10px;
        }
        
        .user-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .help-content, .profile-content, .leaderboard-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .help-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .help-list {
            margin-left: 20px;
            margin-bottom: 30px;
        }
        
        .help-list li {
            margin-bottom: 10px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-item h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .stat-item p {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3498db;
        }
        
        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .leaderboard-tab {
            padding: 10px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 8px;
            font-family: 'CMU Serif', serif;
            font-size: 1rem;
            font-weight: 700;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .leaderboard-tab:hover {
            background: #d5dbdb;
            color: #2c3e50;
        }
        
        .leaderboard-tab.active {
            background: #3498db;
            color: white;
        }
        
        .leaderboard-list {
            background: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .leaderboard-item.top3 {
            border-left-color: #f39c12;
            background: #fef9e7;
        }
        
        .leaderboard-item.rank1 {
            border-left-color: #f1c40f;
            background: #fffbf0;
        }
        
        .leaderboard-rank {
            font-weight: 700;
            color: #2c3e50;
            min-width: 40px;
        }
        
        .leaderboard-username {
            flex: 1;
            margin-left: 15px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .leaderboard-score {
            font-weight: 700;
            color: #3498db;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .modal-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .auth-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-family: 'CMU Serif', serif;
            font-size: 1rem;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #27ae60;
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            z-index: 2000;
            animation: scorePopup 2s ease-in-out forwards;
            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.5);
        }
        
        @keyframes scorePopup {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                align-items: center;
            }
            
            .top-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-info {
                gap: 30px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .number-box {
                width: 60px;
                height: 60px;
                font-size: 1.2rem;
            }
            
            .tabs-container {
                flex-wrap: wrap;
            }
            
            .tab {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Make the Number</h1>
        
        <div class="tabs-container">
            <button class="tab active" onclick="switchTab('2digit')">2 Digit</button>
            <button class="tab" onclick="switchTab('3digit')">3 Digit</button>
            <button class="tab" onclick="switchTab('make24')">Make 24</button>
            <button class="tab" onclick="switchTab('leaderboard')">Leaderboard</button>
            <button class="tab" onclick="switchTab('profile')">Profile</button>
            <button class="tab" onclick="switchTab('help')">Help</button>
        </div>
        
        <div class="auth-container" id="authContainer">
            <button class="btn btn-primary" onclick="showSignIn()">Sign In</button>
            <button class="btn btn-secondary" onclick="showSignUp()">Sign Up</button>
        </div>
        
        <div class="user-info" id="userInfo" style="display: none;">
            <span>Welcome, <span id="username"></span>!</span>
            <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
        </div>
        
        <div class="top-controls" id="gameControls">
            <div class="left-controls">
                <button class="btn btn-primary" onclick="startGame()">Random</button>
            </div>
            <div class="right-controls">
                <div class="time-input">
                    <label>Timer:</label>
                    <input type="number" id="timeInput" value="30" min="10" max="300">
                    <label>second</label>
                </div>
            </div>
        </div>
        
        <div class="game-info" id="gameInfo">
            <div class="info-item">
                <div>Answer</div>
                <div class="target-number" id="targetNumber">--</div>
            </div>
            <div class="info-item">
                <div>Time Left</div>
                <div class="timer" id="timer">--</div>
            </div>
        </div>
        
        <div class="game-content" id="gameContent">
            <div class="main-content">
                <div class="left-section">
                    <div class="numbers-section">
                        <div class="numbers-container four-numbers" id="numbersContainer">
                            <!-- Original numbers will be generated here -->
                        </div>
                        <div class="results-container" id="resultsContainer">
                            <!-- Result numbers will appear here -->
                        </div>
                    </div>
                </div>
                
                <div class="operators-container">
                    <button class="operator-btn" id="op-add" onclick="selectOperation('add')">+</button>
                    <button class="operator-btn" id="op-subtract" onclick="selectOperation('subtract')">−</button>
                    <button class="operator-btn" id="op-multiply" onclick="selectOperation('multiply')">×</button>
                    <button class="operator-btn" id="op-divide" onclick="selectOperation('divide')">÷</button>
                    <button class="operator-btn" id="op-power" onclick="selectOperation('power')">$x^n$</button>
                    <button class="operator-btn" id="op-root" onclick="applyOperation('root')">$\sqrt{x}$</button>
                    <button class="operator-btn" id="op-nroot" onclick="selectOperation('nroot')">$\sqrt[n]{x}$</button>
                    <button class="operator-btn" id="op-factorial" onclick="applyOperation('factorial')">$x!$</button>
                    <button class="operator-btn" id="op-summation" onclick="selectOperation('summation')">$\displaystyle\sum_{i=n}^{m} i$</button>
                    <button class="operator-btn" id="op-summation2i" onclick="selectOperation('summation2i')">$\displaystyle\sum_{i=n}^{m} \left(i+i\right)$</button>
                    <button class="operator-btn" id="op-summationi2" onclick="selectOperation('summationi2')">$\displaystyle\sum_{i=n}^{m} \left(i\times i\right)$</button>
                </div>
            </div>
            
            <div class="reset-container">
                <button class="btn btn-secondary" onclick="resetNumbers()">Reset</button>
            </div>
            
            <div class="message" id="message">Click "Random" to start!</div>
        </div>
        
        <div class="help-content" id="helpContent" style="display: none;">
            <div class="help-section">
                <h2>How to Play</h2>
                <ol class="help-list">
                    <li>Choose your game mode: $2$ Digit, $3$ Digit, or Make $24$</li>
                    <li>Click "Random" to generate numbers and an answer</li>
                    <li>Select numbers and operations to reach the answer</li>
                </ol>
                
                <h2>Operations</h2>
                <ul class="help-list">
                    <li>$+$ e.g. $2+4=6$</li>
                    <li>$-$ e.g. $7-5=2$</li>
                    <li>$\times$ e.g. $9\times5=45$</li>
                    <li>$\div$ e.g. $8\div2=4$, $3\div7=\dfrac{3}{7}$</li>
                    <li>$x^n$ e.g. $2\times3=8$</li>
                    <li>$\sqrt{x}$ e.g. $\sqrt{4}=2$</li>
                    <li>$\sqrt[n]{x}$ e.g. $\sqrt[3]{8}=2$</li>
                    <li>$x!$ e.g. $4!=24$</li>
                    <li>$\displaystyle\sum_{i=n}^{m} i$ e.g. $\displaystyle\sum_{i=1}^{4}=1+2+3+4=10$,$\displaystyle\sum_{i=3}^{6}=3+4+5+6=18$</li>
                    <li>$\displaystyle\sum_{i=n}^{m}\left(i+i\right)$ e.g. $\displaystyle\sum_{i=1}^{4}\left(i+i\right)=2+4+6+8=20$</li>
                    <li>$\displaystyle\sum_{i=n}^{m}\left(i\times i\right)$ e.g. $\displaystyle\sum_{i=1}^{6}\left(i+i\right)=1^2+2^2+3^2+4^2+5^2+6^2=91$</li>
                </ul>
            </div>
        </div>
        
        <div class="profile-content" id="profileContent" style="display: none;">
            <div class="profile-section">
                <h2 id="profileTitle">-</h2>
                <div class="profile-stats">
                    <div class="stat-item">
                        <h3>2 Digit Score</h3>
                        <p id="score2digit">0</p>
                    </div>
                    <div class="stat-item">
                        <h3>3 Digit Score</h3>
                        <p id="score3digit">0</p>
                    </div>
                    <div class="stat-item">
                        <h3>Make 24 Score</h3>
                        <p id="scoremake24">0</p>
                    </div>
                    <div class="stat-item">
                        <h3>Fastest Time</h3>
                        <p id="fastestTime">--</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="leaderboard-content" id="leaderboardContent" style="display: none;">
            <div class="leaderboard-section">
                <h2>Leaderboards (Top 100)</h2>
                <div class="leaderboard-tabs">
                    <button class="leaderboard-tab active" onclick="showLeaderboard('2digit')">2 Digit Score</button>
                    <button class="leaderboard-tab" onclick="showLeaderboard('3digit')">3 Digit Score</button>
                    <button class="leaderboard-tab" onclick="showLeaderboard('make24')">Make 24 Score</button>
                    <button class="leaderboard-tab" onclick="showLeaderboard('fastest')">Fastest Time</button>
                </div>
                <div class="leaderboard-list" id="leaderboardList">
                    <p>Loading leaderboard...</p>
                </div>
            </div>
        </div>
        
        <!-- Auth Modals -->
        <div class="modal" id="signInModal" style="display: none;">
            <div class="modal-content">
                <h2>Sign In</h2>
                <input type="email" id="signInEmail" placeholder="Email" class="auth-input">
                <input type="password" id="signInPassword" placeholder="Password" class="auth-input">
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="signIn()">Sign In</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
        
        <div class="modal" id="signUpModal" style="display: none;">
            <div class="modal-content">
                <h2>Sign Up</h2>
                <input type="text" id="signUpUsername" placeholder="Username" class="auth-input">
                <input type="email" id="signUpEmail" placeholder="Email" class="auth-input">
                <input type="password" id="signUpPassword" placeholder="Password" class="auth-input">
                <div class="modal-buttons">
                    <button class="btn btn-primary" onclick="signUp()">Sign Up</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBTOdJwwFBAhSQqv0DGevEhRsZCayAeNTc",
            authDomain: "make-the-number.firebaseapp.com",
            projectId: "make-the-number",
            storageBucket: "make-the-number.firebasestorage.app",
            messagingSenderId: "686510098218",
            appId: "1:686510098218:web:5d26de8df44a2427ccc053",
            measurementId: "G-Y6EB0MXTX2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let currentMode = '2digit';
        let currentTab = '2digit';
        let gameStartTime = null;
        let gameStates = {
            '2digit': {
                originalNumbers: [],
                resultNumbers: [],
                startingNumbers: [],
                targetNumber: 0,
                selectedBox: null,
                selectedOperation: null,
                timeLeft: 30,
                timer: null,
                gameActive: false,
                nextId: 0
            },
            '3digit': {
                originalNumbers: [],
                resultNumbers: [],
                startingNumbers: [],
                targetNumber: 0,
                selectedBox: null,
                selectedOperation: null,
                timeLeft: 30,
                timer: null,
                gameActive: false,
                nextId: 0
            },
            'make24': {
                originalNumbers: [],
                resultNumbers: [],
                startingNumbers: [],
                targetNumber: 24,
                selectedBox: null,
                selectedOperation: null,
                timeLeft: 30,
                timer: null,
                gameActive: false,
                nextId: 0
            }
        };

        function getCurrentGameState() {
            return gameStates[currentMode];
        }

        // Authentication state observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('userInfo').style.display = 'flex';
                loadUserProfile();
            } else {
                currentUser = null;
                document.getElementById('authContainer').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
            }
        });

        function showSignIn() {
            document.getElementById('signInModal').style.display = 'flex';
        }

        function showSignUp() {
            document.getElementById('signUpModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('signInModal').style.display = 'none';
            document.getElementById('signUpModal').style.display = 'none';
        }

        async function signIn() {
            const email = document.getElementById('signInEmail').value;
            const password = document.getElementById('signInPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                closeModal();
                updateMessage('Successfully signed in!', 'success');
            } catch (error) {
                updateMessage('Sign in failed: ' + error.message, 'error');
            }
        }

        async function signUp() {
            const username = document.getElementById('signUpUsername').value;
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            
            if (!username.trim()) {
                updateMessage('Please enter a username!', 'error');
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Create user profile in Firestore
                await db.collection('users').doc(user.uid).set({
                    username: username,
                    email: email,
                    score2digit: 0,
                    score3digit: 0,
                    scoreMake24: 0,
                    fastestTime: null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                closeModal();
                updateMessage('Account created successfully!', 'success');
            } catch (error) {
                updateMessage('Sign up failed: ' + error.message, 'error');
            }
        }

        async function signOut() {
            try {
                await auth.signOut();
                updateMessage('Signed out successfully!', 'info');
            } catch (error) {
                updateMessage('Sign out failed: ' + error.message, 'error');
            }
        }

        async function loadUserProfile() {
            if (!currentUser) {
                document.getElementById('profileTitle').textContent = '-';
                document.getElementById('score2digit').textContent = 0;
                document.getElementById('score3digit').textContent = 0;
                document.getElementById('scoremake24').textContent = 0;
                document.getElementById('fastestTime').textContent = '--';
                return;
            }
            
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('username').textContent = userData.username;
                    document.getElementById('profileTitle').textContent = userData.username;
                    document.getElementById('score2digit').textContent = userData.score2digit || 0;
                    document.getElementById('score3digit').textContent = userData.score3digit || 0;
                    document.getElementById('scoremake24').textContent = userData.scoremake24 || 0;
                    document.getElementById('fastestTime').textContent = userData.fastestTime ? userData.fastestTime + 's' : '--';
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        function switchTab(mode) {
            // Clear any running timer
            const currentState = getCurrentGameState();
            if (currentState.timer) {
                clearInterval(currentState.timer);
            }
            
            // Update tab appearance
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all content areas
            document.getElementById('gameContent').style.display = 'none';
            document.getElementById('helpContent').style.display = 'none';
            document.getElementById('profileContent').style.display = 'none';
            document.getElementById('leaderboardContent').style.display = 'none';
            document.getElementById('gameControls').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'none';
            
            currentTab = mode;
            
            // Show appropriate content
            if (['2digit', '3digit', 'make24'].includes(mode)) {
                document.getElementById('gameContent').style.display = 'block';
                document.getElementById('gameControls').style.display = 'flex';
                document.getElementById('gameInfo').style.display = 'flex';
                currentMode = mode;
                
                // Update numbers container layout
                const container = document.getElementById('numbersContainer');
                if (mode === '3digit') {
                    container.className = 'numbers-container five-numbers';
                } else {
                    container.className = 'numbers-container four-numbers';
                }
                
                // Update display
                updateNumbersDisplay();
                updateTimerDisplay();
                const targetEl = document.getElementById('targetNumber');
                targetEl.classList.remove('spinning');
                targetEl.textContent = getCurrentGameState().targetNumber || '--';
                
                // Update message based on mode
                let modeMessage = '';
                switch(mode) {
                    case '2digit':
                        modeMessage = 'Use 4 numbers to make a 2-digit target (10-99)!';
                        break;
                    case '3digit':
                        modeMessage = 'Use 5 numbers to make a 3-digit target (100-999)!';
                        break;
                    case 'make24':
                        modeMessage = 'Use 4 numbers to make exactly 24!';
                        break;
                }
                updateMessage(modeMessage + ' Click "Random" to start!', 'info');
            } else if (mode === 'help') {
                document.getElementById('helpContent').style.display = 'block';
            } else if (mode === 'profile') {
                document.getElementById('profileContent').style.display = 'block';
                loadUserProfile();
            } else if (mode === 'leaderboard') {
                document.getElementById('leaderboardContent').style.display = 'block';
                // Set default active tab and show 2digit leaderboard
                document.querySelectorAll('.leaderboard-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelector('.leaderboard-tab').classList.add('active');
                showLeaderboard('2digit');
            }
        }

        function generateValidNumbers(count, allowZero = true) {
            let numbers;
            let attempts = 0;
            
            do {
                numbers = [];
                for (let i = 0; i < count; i++) {
                    if (currentMode === 'make24' && !allowZero) {
                        numbers.push(Math.floor(Math.random() * 9) + 1); // 1-9 for Make 24
                    } else {
                        numbers.push(Math.floor(Math.random() * 10)); // 0-9 for others
                    }
                }
                attempts++;
            } while (!isValidNumberSet(numbers) && attempts < 100);
            
            return numbers;
        }

        function isValidNumberSet(numbers) {
            // Count occurrences of each number
            const counts = {};
            for (const num of numbers) {
                counts[num] = (counts[num] || 0) + 1;
            }
            
            // Check if any number appears more than twice
            const duplicateCounts = Object.values(counts).filter(count => count > 1);
            
            // Allow at most one pair (no triples or quadruples)
            return duplicateCounts.length <= 1 && Math.max(...Object.values(counts)) <= 2;
        }

        async function showLeaderboard(type) {
            // Update leaderboard tab appearance
            document.querySelectorAll('.leaderboard-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '<p>Loading leaderboard...</p>';
            
            try {
                let query;
                let scoreField;
                
                switch(type) {
                    case '2digit':
                        scoreField = 'score2digit';
                        break;
                    case '3digit':
                        scoreField = 'score3digit';
                        break;
                    case 'make24':
                        scoreField = 'scoremake24';
                        break;
                    case 'fastest':
                        scoreField = 'fastestTime';
                        break;
                }
                
                if (type === 'fastest') {
                    query = db.collection('users')
                        .where('fastestTime', '!=', null)
                        .orderBy('fastestTime', 'asc')
                        .limit(100);
                } else {
                    query = db.collection('users')
                        .orderBy(scoreField, 'desc')
                        .limit(100);
                }
                
                const snapshot = await query.get();
                
                if (snapshot.empty) {
                    leaderboardList.innerHTML = '<p>No scores yet. Be the first!</p>';
                    return;
                }
                
                let html = '';
                snapshot.docs.forEach((doc, index) => {
                    const userData = doc.data();
                    const rank = index + 1;
                    const score = type === 'fastest' ? userData[scoreField] + 's' : userData[scoreField];
                    
                    let itemClass = 'leaderboard-item';
                    if (rank === 1) itemClass += ' rank1';
                    else if (rank <= 3) itemClass += ' top3';
                    
                    html += `
                        <div class="${itemClass}">
                            <span class="leaderboard-rank">#${rank}</span>
                            <span class="leaderboard-username">${userData.username}</span>
                            <span class="leaderboard-score">${score}</span>
                        </div>
                    `;
                });
                
                leaderboardList.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                leaderboardList.innerHTML = '<p>Error loading leaderboard. Please try again.</p>';
            }
        }

        function showScorePopup(score) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${score.toFixed(1)} points!`;
            document.body.appendChild(popup);
            
            setTimeout(() => {
                document.body.removeChild(popup);
            }, 2000);
        }

        async function updateScore(gameMode, timeUsed) {
            if (!currentUser) return;
            
            try {
                const timerSetting = parseInt(document.getElementById('timeInput').value) || 30;
                const scoreToAdd = 30 / timerSetting;
                
                const userRef = db.collection('users').doc(currentUser.uid);
                const doc = await userRef.get();
                
                if (doc.exists) {
                    const userData = doc.data();
                    const updates = {};
                    
                    // Update score for the specific game mode
                    const currentScore = userData[`score${gameMode}`] || 0;
                    updates[`score${gameMode}`] = currentScore + scoreToAdd;
                    
                    // Update fastest time if this is faster
                    const currentFastest = userData.fastestTime;
                    if (!currentFastest || timeUsed < currentFastest) {
                        updates.fastestTime = timeUsed;
                    }
                    
                    await userRef.update(updates);
                    
                    // Show score popup
                    showScorePopup(scoreToAdd);
                    
                    // Refresh profile display
                    loadUserProfile();
                    
                    updateMessage(`Score updated! +${scoreToAdd.toFixed(1)} points for ${gameMode}!`, 'success');
                }
            } catch (error) {
                console.error('Error updating score:', error);
            }
        }

        function startGame() {
            const gameState = getCurrentGameState();
            
            // Record game start time
            gameStartTime = Date.now();
            
            // Remove any existing spinning classes first, then add them
            document.querySelectorAll('.number-box').forEach(box => {
                box.classList.remove('spinning');
                // Force reflow to ensure the class removal takes effect
                box.offsetHeight;
                box.classList.add('spinning');
            });
            
            const targetEl = document.getElementById('targetNumber');
            targetEl.classList.remove('spinning');
            // Force reflow to ensure the class removal takes effect
            targetEl.offsetHeight;
            targetEl.classList.add('spinning');
            
            setTimeout(() => {
                // Generate numbers based on current mode
                let numberCount, newNumbers;
                switch(currentMode) {
                    case '2digit':
                        numberCount = 4;
                        newNumbers = generateValidNumbers(numberCount);
                        break;
                    case '3digit':
                        numberCount = 5;
                        newNumbers = generateValidNumbers(numberCount);
                        break;
                    case 'make24':
                        numberCount = 4;
                        newNumbers = generateValidNumbers(numberCount, false); // No zeros for Make 24
                        break;
                }
                
                gameState.startingNumbers = [...newNumbers];
                gameState.originalNumbers = newNumbers.map((num, index) => ({
                    id: index,
                    value: num,
                    isOriginal: true,
                    used: false
                }));
                
                gameState.resultNumbers = [];
                gameState.nextId = numberCount;
                
                // Generate target number based on mode
                switch(currentMode) {
                    case '2digit':
                        gameState.targetNumber = Math.floor(Math.random() * 90) + 10; // 10-99
                        break;
                    case '3digit':
                        gameState.targetNumber = Math.floor(Math.random() * 900) + 100; // 100-999
                        break;
                    case 'make24':
                        gameState.targetNumber = 24; // Always 24
                        break;
                }
                
                // Set timer
                gameState.timeLeft = parseInt(document.getElementById('timeInput').value) || 30;
                
                // Update display
                document.getElementById('targetNumber').textContent = gameState.targetNumber;
                document.getElementById('timer').className = 'timer';
                updateNumbersDisplay();
                updateMessage('Game started! Select a number, then choose an operation.', 'info');
                
                // Start timer
                startTimer();
                gameState.gameActive = true;
            }, 600);
        }

        function updateNumbersDisplay() {
            const gameState = getCurrentGameState();
            
            // Update original numbers
            const originalContainer = document.getElementById('numbersContainer');
            originalContainer.innerHTML = '';
            
            gameState.originalNumbers.forEach((numObj) => {
                const box = document.createElement('div');
                box.className = numObj.used ? 'number-box original used' : 'number-box original';
                box.innerHTML = numObj.used ? '' : formatNumber(numObj.value);
                if (!numObj.used) {
                    box.onclick = () => selectBox(numObj.id, true);
                }
                box.id = `box-${numObj.id}`;
                originalContainer.appendChild(box);
            });
            
            // Update result numbers
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            gameState.resultNumbers.forEach((numObj) => {
                const box = document.createElement('div');
                box.className = 'number-box result animate-in';
                box.innerHTML = formatNumber(numObj.value);
                box.onclick = () => selectBox(numObj.id, false);
                box.id = `box-${numObj.id}`;
                resultsContainer.appendChild(box);
            });
            
            gameState.selectedBox = null;
            clearOperationSelection();
            
            // Re-render MathJax if available
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        }

        function formatNumber(value) {
            if (typeof value === 'object' && value.type === 'fraction') {
                return `$\\frac{${value.numerator}}{${value.denominator}}$`;
            }
            return value.toString();
        }

        function selectBox(id, isOriginal) {
            const gameState = getCurrentGameState();
            if (!gameState.gameActive) return;
            
            // If we have a selected operation and this is the second number
            if (gameState.selectedOperation && gameState.selectedBox !== null && gameState.selectedBox.id !== id) {
                // Apply the two-number operation
                applyTwoNumberOperation(gameState.selectedBox, {id, isOriginal}, gameState.selectedOperation);
                return;
            }
            
            // Clear previous selection
            document.querySelectorAll('.number-box').forEach(box => {
                box.classList.remove('selected');
            });
            
            // Clear operation selection
            clearOperationSelection();
            
            // Select new box
            gameState.selectedBox = {id, isOriginal};
            document.getElementById(`box-${id}`).classList.add('selected');
        }
        
        function selectOperation(operation) {
            const gameState = getCurrentGameState();
            if (!gameState.gameActive || gameState.selectedBox === null) {
                updateMessage('Please select a number first!', 'error');
                return;
            }
            
            // Clear previous operation selection
            clearOperationSelection();
            
            // Select new operation
            gameState.selectedOperation = operation;
            document.getElementById(`op-${operation}`).classList.add('selected');
            
            updateMessage(`Selected operation. Now click another number to combine.`, 'info');
        }
        
        function clearOperationSelection() {
            const gameState = getCurrentGameState();
            gameState.selectedOperation = null;
            document.querySelectorAll('.operator-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        function getNumberValue(id, isOriginal) {
            const gameState = getCurrentGameState();
            if (isOriginal) {
                const numObj = gameState.originalNumbers.find(n => n.id === id);
                return numObj ? numObj.value : null;
            } else {
                const numObj = gameState.resultNumbers.find(n => n.id === id);
                return numObj ? numObj.value : null;
            }
        }

        function removeNumber(id, isOriginal) {
            const gameState = getCurrentGameState();
            if (isOriginal) {
                const numObj = gameState.originalNumbers.find(n => n.id === id);
                if (numObj) {
                    numObj.used = true;
                }
            } else {
                gameState.resultNumbers = gameState.resultNumbers.filter(n => n.id !== id);
            }
        }

        function applyOperation(operation) {
            const gameState = getCurrentGameState();
            if (!gameState.gameActive || gameState.selectedBox === null) {
                updateMessage('Please select a number first!', 'error');
                return;
            }
            
            const selectedValue = getNumberValue(gameState.selectedBox.id, gameState.selectedBox.isOriginal);
            if (selectedValue === null) return;
            
            let result;
            
            try {
                switch (operation) {
                    case 'root':
                        if (selectedValue < 0) {
                            updateMessage('Cannot take square root of negative number!', 'error');
                            return;
                        }
                        result = Math.sqrt(selectedValue);
                        break;
                        
                    case 'factorial':
                        if (selectedValue < 0 || selectedValue > 10 || selectedValue !== Math.floor(selectedValue)) {
                            updateMessage('Factorial only works for integers 0-10!', 'error');
                            return;
                        }
                        result = factorial(selectedValue);
                        break;
                }
                
                // Remove the original number and add result
                removeNumber(gameState.selectedBox.id, gameState.selectedBox.isOriginal);
                gameState.resultNumbers.push({
                    id: gameState.nextId++,
                    value: Math.round(result * 1000) / 1000,
                    isOriginal: false
                });
                
                updateNumbersDisplay();
                updateMessage(`Applied operation. Result: ${result}`, 'info');
                
                checkWin();
                
            } catch (error) {
                updateMessage('Invalid operation!', 'error');
            }
        }
        
        function applyTwoNumberOperation(firstBox, secondBox, operation) {
            const gameState = getCurrentGameState();
            const value1 = getNumberValue(firstBox.id, firstBox.isOriginal);
            const value2 = getNumberValue(secondBox.id, secondBox.isOriginal);
            
            if (value1 === null || value2 === null) return;
            
            let result;
            let resultObj;
            
            try {
                switch (operation) {
                    case 'add':
                        result = value1 + value2;
                        break;
                    case 'subtract':
                        result = value1 - value2;
                        break;
                    case 'multiply':
                        result = value1 * value2;
                        break;
                    case 'divide':
                        if (value2 === 0) {
                            updateMessage('Cannot divide by zero!', 'error');
                            return;
                        }
                        // Try to create fraction if it results in a nice fraction
                        if (Number.isInteger(value1) && Number.isInteger(value2)) {
                            const gcd = findGCD(Math.abs(value1), Math.abs(value2));
                            const num = value1 / gcd;
                            const den = value2 / gcd;
                            if (den !== 1 && Math.abs(den) <= 20 && Math.abs(num) <= 100) {
                                resultObj = {
                                    type: 'fraction',
                                    numerator: num,
                                    denominator: den,
                                    valueOf: () => value1 / value2
                                };
                            }
                        }
                        if (!resultObj) {
                            result = value1 / value2;
                        }
                        break;
                    case 'power':
                        if (value1 === 0 && value2 < 0) {
                            updateMessage('Cannot raise 0 to negative power!', 'error');
                            return;
                        }
                        result = Math.pow(value1, value2);
                        break;
                    case 'nroot':
                        if (value2 === 0) {
                            updateMessage('Cannot take 0th root!', 'error');
                            return;
                        }
                        if (value1 < 0 && value2 % 2 === 0) {
                            updateMessage('Cannot take even root of negative number!', 'error');
                            return;
                        }
                        result = Math.pow(value1, 1/value2);
                        break;
                    case 'summation':
                        if (value2 < value1) {
                            updateMessage('Second number must be greater than or equal to first number!', 'error');
                            return;
                        }
                        if (!Number.isInteger(value1) || !Number.isInteger(value2)) {
                            updateMessage('Summation only works with integers!', 'error');
                            return;
                        }
                        // Calculate sum from value1 to value2: n + (n+1) + ... + m
                        result = 0;
                        for (let i = value1; i <= value2; i++) {
                            result += i;
                        }
                        break;
                    case 'summation2i':
                        if (value2 < value1) {
                            updateMessage('Second number must be greater than or equal to first number!', 'error');
                            return;
                        }
                        if (!Number.isInteger(value1) || !Number.isInteger(value2)) {
                            updateMessage('Summation only works with integers!', 'error');
                            return;
                        }
                        result = 0;
                        for (let i = value1; i <= value2; i++) {
                            result += i+i;
                        }
                        break;
                    case 'summationi2':
                        if (value2 < value1) {
                            updateMessage('Second number must be greater than or equal to first number!', 'error');
                            return;
                        }
                        if (!Number.isInteger(value1) || !Number.isInteger(value2)) {
                            updateMessage('Summation only works with integers!', 'error');
                            return;
                        }
                        result = 0;
                        for (let i = value1; i <= value2; i++) {
                            result += i*i;
                        }
                        break;
                }
                
                // Remove both numbers and add result
                removeNumber(firstBox.id, firstBox.isOriginal);
                removeNumber(secondBox.id, secondBox.isOriginal);
                
                gameState.resultNumbers.push({
                    id: gameState.nextId++,
                    value: resultObj || (Math.round(result * 1000) / 1000),
                    isOriginal: false
                });
                
                clearOperationSelection();
                updateNumbersDisplay();
                updateMessage(`Great!`, 'info');
                
                checkWin();
                
            } catch (error) {
                updateMessage('Invalid operation!', 'error');
            }
        }

        function findGCD(a, b) {
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }

        function checkWin() {
            const gameState = getCurrentGameState();
            
            // Count available (non-used) numbers
            const availableOriginals = gameState.originalNumbers.filter(n => !n.used);
            const availableResults = gameState.resultNumbers;
            const totalAvailable = availableOriginals.length + availableResults.length;
            
            // Only check for win if we have exactly one number left (all numbers used except one final result)
            if (totalAvailable === 1) {
                const finalValue = availableOriginals.length > 0 ? 
                    availableOriginals[0].value : 
                    (typeof availableResults[0].value === 'object' ? 
                        availableResults[0].value.valueOf() : 
                        availableResults[0].value);
                        
                const finalNumber = Math.round(finalValue);
                if (finalNumber === gameState.targetNumber) {
                    // Calculate time used
                    const timeUsed = Math.round((Date.now() - gameStartTime) / 1000);
                    
                    // Add win animations
                    document.getElementById('timer').classList.add('win');
                    document.querySelectorAll('.number-box').forEach(box => {
                        box.classList.add('win');
                    });
                    
                    // Update score if user is signed in
                    if (currentUser) {
                        updateScore(currentMode, timeUsed);
                    } else {
                        updateMessage(`🎉 Congratulations! You made ${gameState.targetNumber} in ${timeUsed}s! Sign in to save your score!`, 'success');
                    }
                    
                    endGame();
                } else {
                    updateMessage(`You made ${finalNumber}, but the target was ${gameState.targetNumber}. Try again!`, 'error');
                }
            }
        }

        function startTimer() {
            const gameState = getCurrentGameState();
            clearInterval(gameState.timer);
            updateTimerDisplay();
            
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    document.getElementById('timer').classList.add('timeout');
                    updateMessage('Time\'s up! Try again with a new game.', 'error');
                    endGame();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const gameState = getCurrentGameState();
            document.getElementById('timer').textContent = (gameState.timeLeft || 0);
        }

        function endGame() {
            const gameState = getCurrentGameState();
            gameState.gameActive = false;
            clearInterval(gameState.timer);
        }

        function resetNumbers() {
            const gameState = getCurrentGameState();
            if (!gameState.gameActive) {
                updateMessage('Start a new game first!', 'error');
                return;
            }
            
            // Restore all original numbers from the starting values
            gameState.originalNumbers = gameState.startingNumbers.map((num, index) => ({
                id: index,
                value: num,
                isOriginal: true,
                used: false
            }));
            
            // Clear all result numbers
            gameState.resultNumbers = [];
            
            // Reset timer colors and animations
            document.getElementById('timer').className = 'timer';
            document.querySelectorAll('.number-box').forEach(box => {
                box.classList.remove('win');
            });
            
            updateNumbersDisplay();
            updateMessage('All numbers reset to original values!', 'info');
        }

        function updateMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
        }

        // Initialize display
        updateNumbersDisplay();
        
        // Initialize MathJax when it loads
        window.addEventListener('load', () => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97321c0ea6b5d028',t:'MTc1NTg2Mjk3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
